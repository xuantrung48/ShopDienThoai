@inject AppDbContext context
@{
    ViewBag.Title = "Thế giới điện thoại - Cửa hàng điện thoại, tablet, laptop lớn nhất Việt Nam";
    var brands = ViewBag.Brands as List<Brand>;
    var categories = ViewBag.Categories as List<Category>;
    var products = ViewBag.Products as List<Product>;
}

@foreach (var category in categories)
{
    <h3 class="text-center text-light bg-info rounded px-2"><a asp-controller="Home" asp-action="Category" asp-route-id="@category.CategoryId" class="nav-link text-light">@category.Name</a></h3>
    <div class="row">
        @{
            var productInCategory = (from e in products
                               where e.CategoryId == category.CategoryId && e.Remain > 0
                               select e).Take(8);
        }

        @foreach (var product in productInCategory)
        {
            var productTitle = string.Empty;
            if (categories != null)
                productTitle += $" {(from e in categories where e.CategoryId == product.CategoryId select e).FirstOrDefault().Name}";
            if (brands != null)
                productTitle += $" {(from e in brands where e.BrandId == product.BrandId select e).FirstOrDefault().Name}";
            productTitle += $" {product.Name} ({product.Ram} GB, {product.Rom} GB)";
            <div class="col-md-4 col-lg-3 col-sm-6 card-group">
                <div class="card rounded my-3 bg-transparent py-2">
                    <a asp-controller="Home" asp-action="ViewProduct" asp-route-id="@product.ProductId">
                        @{
                            var productImages = (from e in context.Images
                                                 where e.ProductId == product.ProductId
                                                 select e).ToList();
                            if (productImages.Count != 0)
                            {
                                <img src="~/images/products/@productImages[0].ImageName" alt="@productTitle" style="max-height:180px; max-width:140px" class="mx-auto d-block">
                            }
                        }
                    </a>
                    <div class="card-body">
                        <h5 class="card-title text-center">
                            <a asp-controller="Home" asp-action="ViewProduct" asp-route-id="@product.ProductId">
                                @productTitle
                            </a>
                        </h5>
                    </div>
                    <div class="card-footer text-center text-danger bg-transparent">
                        <h5>@product.Price.ToString("#,##0") ₫</h5>
                    </div>
                </div>
            </div>
        }
    </div>
}